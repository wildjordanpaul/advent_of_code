package advent18

import shared.AdventSolution
import shared.Point

fun main(args: Array<String>) = object : AdventSolution(
        mapOf(
            """
/->-\
|   |  /----\
| /-+--+-\  |
| | |  | v  |
\-+-/  \-+--/
  \------/
            """ to "7,3"
        ),
        mapOf(
            """
/>-<\
|   |
| /<+-\
| | | v
\>+</ |
  |   ^
  \<->/
            """ to "6,4"
        ),
        """
                                         /---->--------------------------------------------------\
                                         |/------------------------>---------------------\       |
                                         ||                                              |       |              /-----------------------\/---------\
                                         ||               /------------------------------+-------+--------------+-------------\         ||         |
          /------------------------------++-------------\ |                           /--+-------+--------------+-------------+---------++--------\|
    /-----+------------------------------++-------------+-+----------------------\    |  |       |         /----+------------\|         ||        ||
    |/----+------------------------------++-------------+-+---\        /---------+----+--+-------+-----\   |    |            ||         ||        ||
    ||    |                              ||             | |   |        |         |    |  |       |     |   |   /+--------\   ||         ||        ||
    ||    |                              ||             | |   |/-------+---------+----+--+-------+-----+\  |   ||        |   ||         ||        ||
    ||    |       /-----------\          ||  /----------+-+---++-----<-+---------+----+--+-------+-----++--+---++--------+---++---------++----\   ||
    ||    |   /---+-----------+----------++--+----\     | |   ||       |         |    |  |       |     ||  |   ||        |   ||         ||    |   ||
    ||    |   |   |           |         /++--+----+-----+-+---++-------+---------+----+--+\      |     ||  |   ||        |/--++--------\||    |   ||
 /--++----+--\|   |           |         |||  |    |     | |   v|       |         |    |  ||      |     ||  |   ||        ||  ||        |||    |   ||
 |  ||    |  ||   |           |         |||  |    |     |/+---++-------+---------+----+\ ||      |     ||  |   ||        ||  ||        |||    |   ||
 |  ||    |  ||   |           |         |||  |    |     |||   ||       |         |  /-++-++------+-----++--+---++--------++--++---\    |||    |   ||
 |  ||    |  ||   |           |         |||  |    |    /+++---++-------+---------+--+-++-++------+-----++-\|   ||        ||  ||   |    |||    |   ||
 |  ||    |  ||   |           |         |||  |    | /--++++---++-------+---\     |  | || ||      |     || ||   ||  /-----++--++---+\   |||    |   ||
 |  ||    |  ||   |           |/--------+++--+----+-+--++++---++-------+---+-----+--+-++-++------+-----++-++---++--+-----++--++-\ ||   |||    |   ||
 |  ||    |  ||   |           ||        |||  | /--+-+--++++---++-------+---+-----+--+-++-++------+-----++-++---++--+--\  ||  || | ||   |||    |   ||
 |  ||    |  ||   |           ||        |||  |/+--+-+--++++---++-------+---+-----+--+\|| ||      |     || ||   ||  |  |  ||  || | ||   |||    |   ||
 |  ||    |  ||   | /---------++--------+++--+++--+-+--++++---++-------+---+-----+--++++-++--\   |     || ||   ||  |  |  ||  || | ||   |||    |   ||
 |  ||    |  ||   | |       /-++--------+++--+++--+-+--++++\  ||       |   |     |  |||| ||  |   |     || ||   ||  |  |  ||  || | ||   |||    |   ||
 |  ||    \--++---+-+-------+-++--------+++--+++--+-+--+/\++--++-------+---+-----+--+++/ ||  |   |     || ||   ||  |  |  ||  || | ||   |||    |   ||
 |  ||       ||  /+-+-------+-++--------+++--+++--+-+--+--++--++-------+---+-----+--+++--++--+---+-----++-++---++--+-\|  ||  || | ||   |||    |   ||
 |  ||       ||  || |       | ||        |||  |||  | |  |  ||  ||       |   |     | /+++--++--+---+-----++-++---++--+-++--++\ || | ||   |||    |   ||
 |  ||       ||  || |       | ||        |||  |||  | |  |  ||  ||       \---+-----+-++++--++--+---+-----/| ||   ||  | ||  ||| || | ||   |||    |   ||
 |  ||       ||  || |       | ||      /-+++--+++--+-+--+--++--++-----------+-----+-++++--++--+---+------+-++---++--+\||  ||| || | ||   |||    |   ||
 |  ||      /++--++-+-------+-++------+-+++-\|||/-+-+--+--++--++-----------+-----+-++++--++--+---+------+-++---++-\\+++--+++-++-+-+/   |||    |   ||
 |  ||      |||  || |       | ||      | \++-+++++-+-+--+--++--++-----------+-----+-++++--+/  |   | /----+-++---++-+-+++--+++\|| | |    |||    |   ||
 |  ||      |||  ||/+-------+-++------+--++-+++++-+-+--+--++--++-----------+-----+-++++--+---+-\ | |    | |v   || | |||  |||||| | |    |||    |   ||
 |  ||      |||  ||||       | ^|      |  || ||||| | |  |  ||  ||      /----+-----+-++++--+---+<+-+-+----+-++---++\| |||  |||||| | |    |||    |   ||
 \--++------+/|  ||||       | ||  /---+--++-+++++-+-+--+--++--++------+----+-----+-++++--+---+-+-+-+-\  | || /-++++-+++--++++++\| |    |||    |   ||
    ||      | |  ||||       | ||  |   |  ||/+++++-+-+--+--++--++------+----+-----+-++++--+---+-+-+-+-+--+-++-+-++++-+++--++++++++-+----+++\   |   ||
    ||      | |  ||||     /-+-++--+---+--++++++++-+-+--+--++--++------+----+-----+-++++--+---+-+-+-+-+--+-++-+-++++-+++\ |||||||| |    ||||   |   ||
    ||      | |  ||||     | | ||  |   |  |||||||| | |  |  ||  ||   /--+----+-----+-++++--+---+-+-+-+-+--+-++-+-++++-++++-++++++++\|    ||||   |   ||
    ||      | |  ||||     | \-++--+---+--++++++++-+-+--+--+/  || /-+--+----+-----+-++++--+---+-+-+-+-+--+-++-+-++++-++++-++++++++++----++++---+\  ||
    ||      | |  ||||     |   ||  |   |  |||||||| | |  |/-+---++-+-+--+----+-----+-++++--+---+-+<+-+-+--+-++-+-++++-++++\||||||||||    ||||   ||  ||
    ||     /+-+--++++-\   |   ||  |   |  |||||||| | |  || |   ||/+-+--+----+--\  | ||||  |   | | | | |  | || | |||| |||||||||||||||    ||||   ||  ||
    ||/----++-+--++++-+---+---++--+---+--++++++++-+-+--++-+---++++-+--+----+--+--+-++++\ |   | | | | |  | || | |||| |||||||||||||||    ||||   ||  ||
  /-+++----++-+--++++-+---+---++--+-\ |  |||||||| | |  || |   |||| |  |    |  |  | ||||| |  /+-+-+-+-+--+-++-+-++++-+++++++++++++++----++++---++--++-\
  | |||    || |  |||| |   |   ||  | | | /++++++++-+-+--++-+---++++-+--+----+--+--+-+++++-+--++-+-+-+-+--+-++-+\|||| |||||||||||||||    ||||   ||  || |
  | |||    || |  |||| |   |   ||  | | | ||||||||| | |  || | /-++++-+--+----+--+--+-+++++-+--++-+-+-+-+--+-++-++++++-+++++++++++++++----++++-\ ||  || |
  | |||    || |  |||| |   |   ||  | | | ||||||||| | |  || | | |||| |  |    |  |  | ||||| |  || | | | |  | || |||||| |||||||||||||||    |||| | ||  || |
  |/+++----++\|  |||| |   |   ||  | | | ||||||||| | | /++-+-+-++++-+--+----+--+--+\||||| |  || | | | |  | || |||||| |||||||||||||||    |||| | ||  || |
  |||||    ||||  |||| |   |   || /+-+-+-+++++++++\| | ||| | | |||| |  |    |  |  ||||||| |  || | | | |  | || |||||| |||||||||||||||    ||\+-+-++--+/ |
  |||||    ||||  |||| |   |   || ^| | | ||||||||||| | ||| | | |||| |  |    |  |  ||||||| |  || | | | |  | || |||||| |||||||||||||||    || | | ||  |  |
  |||||    ||||  |||| |   |   || || | | ||||||||||| | ||| | | |\++-+--+----+--+--+++++++-+--++-+-+-+-+--/ || |||||| |||||||||||||||/---++-+-+-++\ |  |
  |||||    ||||  |||| |   |   || || | | ||||||||||| | ||| | | | || |  |    |  |  ||||||| |  || | | | |    || |||||| ||||||||||||||||   || | | ||| |  |
  |||||    ||||/-++++-+---+---++-++-+-+-+++++++++++-+-+++-+-+-+-++-+--+---\|  |  ||||||| |  || | | | |    || |||||| ||||||||||||||||   || | | ||| |  |
  |||||    ||||| |||| |   |   || || | | |\+++++++++-+-+++-+-+-+-++-+--+---++--+--+++++++-+--++-+-/ \-+----++-++++++-++++++++/|||||||   || | | ||| |  |
  |||||    ||||| |||| |   |   || ||/+-+-+-+++++++++-+-+++-+-+-+-++-+--+---++--+--+++++++-+--++-+-----+----++\|||\++-++++++++-+++++++---+/ | | ||| |  |
  |||||    ||||| |||| |/--+---++-++++-+-+-+++++++++-+-+++-+-+-+-++-+--+---++--+--+++++++-+--++-+--\  |    |||||| || |||||||| |||||||   |  | | ||| |  |
  |\+++----++/|| |||| ||  |   || |||| | | ||||||||| | ||| | |/+-++-+--+---++-\|  ||||||| |  || |  | /+----++++++-++-++++++++-+++++++---+--+-+\||| |  |
 /+-+++----++-++-++++-++--+---++-++++-+-+-+++++++++-+-+++-+-+++-++-+--+---++-++--+++++++-+--++-+--+-++--\ |||||| || |||||||| |||||||   |  | ||||| |  |
 || |||    \+-++-++++-/|  |   || |||| | | ||||||||| |/+++-+-+++-++-+--+---++-++--+++++++-+--++-+--+-++--+-++++++-++-++++++++-+++++++---+--+-+++++-+-\|
 || |||     | ||/++++--+--+---++-++++-+-+-+++++++++-+++++-+-+++-++-+--+---++-++--+++++++-+--++-+--+-++--+-++++++\|| |||||||| |||||||   |  | ||||| | ||
 || |||     | ||||\++--+--+---/| |||| | | ||||||||| ||||| | ||| || |  |   || ||  |||\+++-+--++-+--+-++--+-+++++++++-++++++++-+++++/|   ^  | ||||| | ||
 || |||     | |||| ||  |  |/---+-++++-+-+-+++++++++-+++++-+-+++-++-+--+---++-++\ ||| ||| |  || |  | ||  | ||||||||| |||||||| ||||| |   |  | ||||| | ||
 || |\+-----+-++++-++--+--++---+-++++-+-+-+++++++++-+++++-+-++/ || |  |   || |||/+++-+++-+--++-+--+-++--+-+++++++++-++++++++-+++++-+-\ |  | ||||| | ||
 || | |/----+-++++-++--+--++---+-++++-+-+-+++++++++-+++++-+-++--++-+-\|   || ||||||| ||| |  || |  | ||  | ||||||||| |||||||| ||||| | | |  | ||||| | ||
 || | || /--+-++++-++--+-\||   | |||| | | ||||||||| ||||| | ||  || | ||   || ||||||| ||| |  || |  | ||  | |\+++++++-++++++++-/|||| | | |  | ||||| | ||
 ||/+-++-+--+-++++-++--+-+++--\| |||| | | ||||||\++-+++++-+-++--++-+-++---++-+++++++-+++-+--++-+--+-++--+-+-++++++/ ||||||||  |||| | | |  | ||||| | ||
 |||| || |  | |||| ||  | |||  || \+++-+-+-++++++-/| ||||| | \+--++-+-++---++-+++++++-+++-+--++-+--+-++--+-+-++++++--++++++++--++++-+-+-+--+-/|||| | ||
 |||| || |/-+-++++-++--+-+++--++--+++-+-+-++++++--+-+++++-+--+--++-+-++---++-+++++++-+++-+--++-+--+-++-\| | |||||| /++++++++--++++-+-+-+-\|  |||| | ||
 |||| || || | |||| ||  | |||  ||/-+++-+-+-++++++--+-+++++-+--+--++-+-++---++-+++++++-+++\| /++-+--+-++\|| | |\++++-+++++++++--+/|| | | | ||  |||| | ||
 |||| || || | |||| ||  | |||  ||| ||| | | ||||||  | ||||| |  |  || | ||   || ||||||| ||||| ||| |  | ||||| | | |||| |||||||||  | || | | | ||  |||| | ||
 |||| || || | |||| ||  | ||\--+++-+++-+-+-++++++--+-+++++-+--+--++-+-++---++-++/|||| ||||| ||| |  | |||||/+-+-++++-+++++++++--+-++-+-+-+-++--++++\| ||
 |||| || || | |||| || /+-++---+++\||| | | ||||||  | ||||| |  |  || | ||   || || |||| ||||| ||| |  | \++++++-+-++++-+++++++++--+-++-+-+-+-++--/||||| ||
 |||| || || | |||| || || ||   ||||||| | | ||||||  | ||||| |  |  || | ||   || || |||| ||||| ||| |  |  |||||| | |||| |||||||||  | || \-+-+-++---++/|| ||
 |||| || || | |||| || || ||   ||||||| | | ||||||  | ||||| |  |  || | |^   || || |||| ||||| ||| |  |  |||||| | |||| |||||||||  | ||   | | ||   || || ||
 |||| || || | |||| || || ||   ||||||| | | ||||||  | ||||| \--+--++-+-++---++-++-++++-+++++-+++-+--+--++++++-+-++++-+++++++++--/ ||   | | ||   || || ||
 |||| || || | |||| || || ||   ||||||| | | ||||||  | |||||    |  || | ||   || || |||| ||||| ||| |  |  |||||| | |||| |||||||||    ||   | | ||   || || ||
 |||| || || | |||| || || ||   ||||||| \-+-++++++--+-+++++----+--++-+-++---++-++-++++-+++++-+++-+--+--++++++-+-++++-+/|||||||    ||   | | ||   || || ||
/++++-++-++-+-++++-++-++-++\  |\+++++---+-++++++--+-+++++----+--++-+-++---++-++-++++-+++++-+++-+--+--++++++-+-++++-+-+++++++----/|   | | ||   || || ||
||||| || || | |||| || || |||  | |||||   | ||||||  | |||||    |  ||/+-++---++-++-++++<+++++-+++-+--+--++++++-+-++++-+-+++++++-----+--\| | ||   || || ||
||||| || || |/++++-++-++-+++--+-+++++---+-++++++--+-+++++----+--++++-++---++-++\|||| ||||| ||| |  |  |||||| | |||| | |||||||     |  || | ||   || || ||
||\++-++-++-++++++-++-++-+++--+-++++/   | ||||||  | |||||    |  |||| ||   || ||||||| ||||| ||| |  |  |||||| | |||| | |||||||     |  || | ||   || || ||
|| || || || |||||| || || |||  | ||||    | ||||||  | ||\++----+--++++-++---++-+++++/| ||||| ||| |  |  |||||| | |||| | |||||\+-----+--++-/ ||   || || ||
|| || || || ||\+++-++-++-+++--+-++++----+-++++++--/ || ||    |  |||| ||   || ||||| | |||||/+++-+--+--++++++-+-++++-+-+++++-+--\  |  ||   ||   || || ||
|| || || || || ||| || || |||  | ||||    | |||\++----++-++----+--++++-++---++-+++++-+-+++++++++-+--+--++++++-+-++++-+-+++++-+--+--+--++---++---/^ || ||
|| || || || || ||| || || |||  | ||||    | ||| ||    || ||    |  |||| ||   || ||||| | ||||||||| |  | /++++++-+-++++-+-+++++-+--+--+--++---++----+-++\||
|| || || || || ||| || || |||/-+-++++----+\||| ||    || ||    |  |||| ||   || ||||| | ||||||||| |  | ||||||| | |||| | ||||| |  |  |  ||   ||    | |||||
|| || || || || |||/++-++-++++\| ||||    ||||| ||    || ||    |  |||| ||   || ||||| | ||||||||| |  | ||||||| |/++++-+-+++++-+\ |  |  ||   ||    | |||||
|| || |\-++-++-++++++-++-++++++-++++----+++++-++----++-++----+--++++-/|   || ||||| | ||||||||| |  | ||||||| |||||| | ||||| || |  |  ||   ||    | |||||
|| || |  || || ||||\+-++-++++++-++++----+++++-++----++-++----+--++++--+---++-+++++-+-+++++++++-/  | ||||||| |||||| | ||||| || |  |  ||   ||    | |||||
|| || |  || || |||| | || |||||| ||||    ||||| ||    || ||    |  ||||  |   || ||||| | |||||||||    | ||||||| |||||| | ||||| || |  |  ||   ||    | |||||
|| || |  || || |||| | || |||||| ||||    ||||| ||    || ||    |  ||||  |   || ||||| | |||||||||    | ||||||| |||||| | ||||| || |  |  ||   ||    | |||||
|| ||/+--++-++-++++-+-++-++++++-++++----+++++-++----++-++----+--++++--+---++-+++++-+-+++++++++--\ | ||||||| |||||| | ||||| || |  |  ||   ||    | |||||
|| ||||  || || |||| | || |||||| ||||    |||||/++----++-++----+--++++--+-\ || ||||| | |||||||||  | | ||||||| |||||| | ||||| || |  |  ||   ||    | |||||
|| ||||  || || |||| | || |\++++-++++----++++++++----++-++----+--++++--+-+-++-+++++-+-+++++++++--+-+-+++++++-++++++-+-++/|| || |  |  ||   ||    | |||||
|| ||||  || || |||| | || | |||| ||||    ||||||||    || ||   /+--++++--+-+-++-+++++-+-+++++++++\ | | ||||||| |||||| | || || || |  |  ||   ||    | |||||
|| ||||  || || |||| | || | |||| |||\----++++++++----++-++---++--++++--+-+-++-+++++-+-++++++++++-+-+-+++++++-/\++++-+-++-++-+/ |  |  ||   ||    | |||||
|| ||||  || || |||| \-++-+-++++-+++-----++++++++----++-++---++--++++--+-+-++-+++++-+-++++++++/| | | |||||||   |||| | || || |  |  |  ||   ||    | |||||
|| ||||  || || ||||   \+-+-++++-+/|     |||||||\----++-++---++--++++--+-+-++-+++++-+-++++++++-+-+-+-+++++++---++++-+-+/ || |  |  |  ||   ||    | |||||
|| ||||  || || ||||    | | |||| \-+-----+++++++-----++-++---++--++++--+-+-++-+++++-+-+++/|||| | | | |||||||   |||| | |  || |  |  |  ||   ||    | |||||
|| ||||  || || ||||/---+-+-++++---+-----+++++++----\|| ||   ||  ||||  | | || ||||| | ||| |||| | | | |||||||   |||| | |  || |  |  |  ||   ||    | |||||
|| ||||  || || |||||   | | ||||/--+-----+++++++----+++-++---++--++++--+-+-++\||||| | ||| |||| | | | |||||||   |||| | |  || |  |  |  ||   ||    | |||||
|| ||||  || || |||||   | | |||||  |     |||||||    ||| |\---++--++++--+-+-++++++++-+-+++-++++-+-+-+-+++++++---++++-+-+--/| |  |  |  ||   ||    | |||||
|| ||||  || || |||||   | | |\+++--+-----+/|||||    ||| |    ||  ||||  | | |||||||| \-+++-++++-+-+-+-+++++++---++++-+-+---+-/  |  |  ||   ||    | |||||
|| ||||  || || |||||   | | | |||  |     | |||||    ||| |    ||  ||||  | | ||||||||   ||| |||| | | | \++++++---++++-+-+---+----+--+--++---++----+-++/||
|| |\++--++-++-+++++---+-+-+-+++--+-----+-+++++----+++-+----++--++++--+-+-+++++++/   ||| |\++-+-+-+--++++++---++++-+-+---+----/  |  ||   ||    | || ||
|| |/++--++-++-+++++---+-+\| |||  |     | |||||    ||| |    \+--++++--+-+-+++++++----+++-+-++-/ | |  |||||| /-++++-+-+---+-------+--++---++-\  | || ||
|| ||||  || || |||||   | ||| |||  |     | \++++----+++-+-----+--++++--+-+-+++++++----+++-/ ||   |/+--++++++-+-++++-+-+---+-------+--++---++-+--+-++\||
|| ||||  || || |||||   | ||| |||  |     |  ||||    ||| |     |  ||||  | | |||||||    |\+---++---+++--++++++-+-++++-+-+---+-------+--++---++-+--+-+/|||
|| ||||  || || |||||   | ||| |||  |    /+--++++----+++-+-----+--++++--+-+-+++++++----+-+---++---+++--++++++-+-++++-+-+---+---\   |  ||   || |  | | |||
|| ||||  || || |||||   | |||/+++--+----++--++++----+++-+-----+--++++--+-+\|||||||    | |   ||   |||/-++++++-+-++++-+-+---+---+---+--++\  || |  | | |||
|| ||||  || || |||||   | |||||||  |    ||  ||\+----+++-+-----+--++++--+-/||||||||    | |   ||   |||| |||||| | |||| | |   |   |   | /+++--++-+-\| | |||
|| ||||  || \+-+++++---+-+++++++--+----++--+/ |    ||| |     |  |||\--+--++++++++----+-+---++---++++-++++++-+-++++-+-+---+---+---/ ||||  || | || | |||
|| ||||  ||  | |||||   | ||||||\--+----++--+--+----+++-+-----+--+++---+--+++/||||    | |   ||   |||| |||||| | |\++-+-+---/   |     ||||  || | || | |||
|| ||||  ||  | |||||   | ||||||   |    ||  |  |    |\+-+-----+--+++---+--++/ ||||    |/+---++---++++-++++++\| | || | |       |     ||||  || | || | |||
|| ||||  ||  | |||||   | ||||||   |    |\--+--+----+-+-+-----+--+++---+--++--++++----+++---++---++++-++++++++-/ || | |       |     ||||  || | || | |||
|| ||||  ||  | |||||   | ||||||   |    |   |  |    | | |     |  |||   |  ||  ||||    |||   |\---++++-++++++++---++-+-+-------+-----++++--++-+-++-+-++/
|| ||||  ||  | |||||   | ||||||   |    |   |  |    | | |     |  |||   |  ||  ||||    |||   |    |\++-++++++++---++-+-+-------+-----++++--++-+-++-+-/|
|| ||||  \+--+-+++++---+-/|||||   |    |   |  |    | | |     |  \++---+--++--+/||    |||   |    | || ||||||||   || | |       |     ||||  || | || |  |
|| ||||   |  | |||||   |  |||||   |    |   |  |    | | |     |   ||   |  ||  | ||    |||   |    | || ||||||||   || | |       |     ||||  || | || |  |
|| ||||   |  | |||||   |  |||||   |    |   |  |    | | \-----+---++---+--++--+-++----+++---+----+-++-+++++/||   || | |       |     ||||  || | || |  |
|| ||||   |  | |||||   |  |||||   |    |   \--+----+-+-------+---++---+--++--+-++----+++---+----+-++-+++++-++---++-+-+-------+-----++++--+/ | |^ |  |
|| ||||   |  | |||||   |  |||||   |    |      |    | |       |   ||   |  ||  | ||    |||   |    | || ||||| ||   || | |       |     ||||  |  | || |  |
|| ||||   |  | |||||   |  |||||   |    |      |    | |       |   ||   |  ||  | ||  /-+++---+----+-++-+++++-++---++-+\|       |     ||||  |  | || |  |
|| ||||   |  | |||||   |  |||||   \----+------+----+-+-------+---++---+--++--+-++--+-+++---+----+-++-/|||| ||   || |||       |     ||||  |  | || |  |
\+-++++---+--+-+++++---+--+/|||        |      |    | |       |   || /-+--++--+-++--+-+++---+----+-++--++++-++---++-+++-------+----\||||  |  | || |  |
 | ||||   |  | |||||   |  | |||        |      \----+-+-------+---++-+-+--++--+-++--+-/||   |    | ||  |||| ||   || ||| /-----+----+++++--+--+\|| |  |
 | ||||   |  | |||||  /+--+-+++--------+-----------+-+-\     |   || | |  ||  | |\--+--++---+----+-++--++++-++---++-+++-+-----+----+++/|  |  |||| |  |
 | ||||   |  | |||||  ||  | |||        |           | | |     |   |\-+-+--++--+-+---+--++---+----+-++--++++-++---++-+++-+-----+----++/ |  |  |||| |  |
 | ||||   |  | ||\++--++--+-+++--------+-----------+-+-+-----+---+--+-+--++--+-+---+--++---+----+-++--++++-++---++-++/ |     |    ||  |  |  |||| |  |
 | |||\---+--+-++-++--++--+-+++--------+-----------+-+-+-----+---+--+-+--++--+-+---+--+/   |    | ||  |||| ||   || ||  |     |    ||  |  |  |||| |  |
 | |||    |  | || \+--++--+-+/|        |           | | |     |   |  | |  ||  | |   |  |    |    | ||  |||| |\---++-++--+-----+----++--+--+--/||| |  |
 | |||    |  |/++--+--++--+-+-+--------+-----------+-+-+-----+---+--+-+--++--+-+---+--+----+----+-++--++++\|    || ||  |     |    ||  |  |   ||| |  |
 | |||    |  ||||  |  ||  | \-+--------+-----------+-+-+-----+---+--+-+--/|  | |   |  |    |    | ||  ||||||    || ||  |     |    ||  |  |   ||| |  |
 | |||    \--++++--+--++--+---+--------+-----------+-+-+-----+---+--+-+---+--+-+---+--+----+----+-++--+/||||    || ||  |     |    ||  |  |   ||| |  |
 | |||       ||||  |  ||  |   |        |           | | |     |   |  | |   |  | |   |  |    |    | ||  | ||||    || ||  |     |   /++--+--+---+++-+-\|
 | |||       ||||  |  ||  |   |        |           ^ | |     |   |  | |   |  | |   |  |    |    | ||  | ||||    || ||  |     |   |||  |  |   ||| | ||
 \-+++-------++++--+--++--+---+--------+-----------+-+-+-----+---+--+-+---+--+-+---+--+----+----+-++--+-/|||    || ||  |     |   ||\--+--+---+/| | ||
   |||       ||||  |  ||  |   |        |           | | |     \---+--+-+---+--/ |   |  \----+----+-++--+--++/    || ||  |     |   ||   |  |   | | | ||
   |||       ||\+--+--++--+---+--------+-----------+-+-+---------+--+-+---/    |   |       |    | ||  |  ||     |v ||  |     |   ||   |  |   | | | ||
   |||       || |  |  \+--+---+--------+-----------+-+-/         |  | \--------+---+-------+----+-++--+--++-----+/ ||  |     |   ||   |  |   | | | ||
   |||       || |  |   |  |   |        |           | |           |  |          |   |       |    | ||  |  ||     |  ||  |     |   ||   |  |   | | | ||
   ||\-------++-+--+---+--+---+--------+-----------+-+-----------+--+----------+---+-------+----/ ||  |  ||     |  ||  |     |   ||   |  |   | | | ||
   ||        || |  |   |  |   |        |           | |           |  \----------+---+-------+------++--+--++-----+--++--+-----+---+/   |  |   | | | ||
   \+--------++-+--+---+--+---/        \-----------+-+-----------+-------------+---+-------+------++--+--++-----+--++--+-----/   |    |  |   | | | ||
    |        || |  |   |  |                        | |           \-------------+---+----<--+------++--+--++-----+--++--+---------+----+--+---+-/ | ||
    |        \+-+--+---+--+------------------------+-+-------------------------/   \-------+------++--+--++-----+--+/  |         |    |  |   |   | ||
    |         \-+--+---+--+------------------------+-+-------------------------------------+------++--+--+/     |  |   |         |    |  |   |   | ||
    |           \--+---+--+------------------------+-+-------------------------------------+------++--+--+------/  |   |         \----+--+---+---+-/|
    |              |   |  |                        | |                                     \------++--/  |         \---+--------------+--/   |   |  |
    \--------------+---+--/                        | |                                            ||     |             |              |      |   |  |
                   |   |                           | \--------------------------------------------++-----+-------------+--------------+------+---+--/
                   |   |                           |                                              ||     |             \--------------+------/   |
                   \---+---------------------------/                                              |\-----+----------------------------/          |
                       \--------------------------------------------------------------------------/      \---------------------------------------/"""
) {

    private fun Char.toDirection(): D13Direction? {
        return if(isWhitespace()) null
        else D13Direction.values().firstOrNull { it.c == this }
    }

    private fun Char.toCell(): D13Cell? {
        return if(isWhitespace()) null
        else D13Cell.values().firstOrNull { cell ->  cell.c.any { it == this } }
    }

    private fun Collection<D13Cart>.sortCarts() = sortedWith(compareBy({ it.y }, { it.x }))

    private fun printOut(grid: Map<Point, D13Cell>, carts: Map<Point, D13Cart>) {
        val maxX = grid.keys.map { it.x }.max()!!
        val maxY = grid.keys.map { it.y }.max()!!
        (0..maxY).forEach { y ->
            println()
            (0..maxX).forEach { x ->
                val pt = Point(x,y)
                val cart = carts[pt]
                if(cart != null)
                    print(cart.currentDirection.c)
                else {
                    print(grid[pt]?.c?.first() ?: ' ')
                }
            }
        }
    }

    private fun build(input: String): Pair<MutableMap<Point, D13Cell>, MutableMap<Point, D13Cart>> {
        val rows = input.split("\n").filter { it.isNotBlank() }
        val grid = mutableMapOf<Point, D13Cell>()

        val carts = mutableMapOf<Point, D13Cart>()

        rows.forEachIndexed { y, row ->
            row.forEachIndexed { x, c ->
                val pt = Point(x,y)
                c.toCell()?.let { cell ->
                    grid[pt] = cell
                }
                c.toDirection()?.let { dir ->
                    carts[pt] = D13Cart(dir, x, y)
                }
            }
        }
        return Pair(grid, carts)
    }

    private inline fun MutableMap<Point, D13Cart>.move(
        grid: Map<Point, D13Cell>,
        onCollision: (D13Cart, D13Cart) -> Unit
    ): MutableMap<Point, D13Cart> {
        values.sortCarts().forEach { cart ->
            val oldPoint = Point(cart.x, cart.y)
            val newPoint = cart.move(grid)
            get(newPoint)?.also {
                onCollision(cart, it)
            }

            remove(oldPoint)
            put(newPoint, cart)
        }
        return this
    }

    fun MutableMap<Point, D13Cart>.removeIf(op: (D13Cart) -> Boolean) {
        val iterator = iterator()
        iterator.forEach {
            if(op(it.value)) iterator.remove()
        }
    }

    override fun solveProblem1(input: String): String {
        val (grid, carts) = build(input)
        while(true) {
            carts.move(grid) { c1, c2 ->
                return@solveProblem1 c1.xy
            }
        }
    }

    override fun solveProblem2(input: String): String {
        val (grid, carts) = build(input)

        while(true) {
            if(carts.size <= 1)
                return carts.values.first().xy

            val cartsToRemove = mutableListOf<D13Cart>()
            carts.move(grid) { c1, c2 ->
                cartsToRemove.add(c1)
                cartsToRemove.add(c2)
            }.removeIf { c1 ->
                cartsToRemove.contains(c1)
            }
        }
    }

}.solve()

data class D13Cart(
    var currentDirection: D13Direction,
    var x: Int,
    var y: Int,
    var intersectionCounter: Int = 0
) {

    val xy: String
        get() = "$x,$y"

    fun move(grid: Map<Point, D13Cell>): Point {
        when(currentDirection) {
            D13Direction.UP -> y -= 1
            D13Direction.DOWN -> y += 1
            D13Direction.LEFT -> x -= 1
            D13Direction.RIGHT -> x += 1
        }

        currentDirection = when(grid[Point(x, y)]) {
            D13Cell.INTERSECTION -> when(intersectionCounter % 3) {
                0 -> when(currentDirection) {
                    D13Direction.UP -> D13Direction.LEFT
                    D13Direction.DOWN -> D13Direction.RIGHT
                    D13Direction.LEFT -> D13Direction.DOWN
                    D13Direction.RIGHT -> D13Direction.UP
                }
                2 -> when(currentDirection) {
                    D13Direction.UP -> D13Direction.RIGHT
                    D13Direction.DOWN -> D13Direction.LEFT
                    D13Direction.LEFT -> D13Direction.UP
                    D13Direction.RIGHT -> D13Direction.DOWN
                }
                else -> currentDirection
            }.also { intersectionCounter += 1 }
            D13Cell.FORWARD_SLASH -> when(currentDirection) {
                D13Direction.UP -> D13Direction.RIGHT
                D13Direction.DOWN -> D13Direction.LEFT
                D13Direction.LEFT -> D13Direction.DOWN
                D13Direction.RIGHT -> D13Direction.UP
            }
            D13Cell.BACK_SLASH -> when(currentDirection) {
                D13Direction.UP -> D13Direction.LEFT
                D13Direction.DOWN -> D13Direction.RIGHT
                D13Direction.LEFT -> D13Direction.UP
                D13Direction.RIGHT -> D13Direction.DOWN
            }
            else -> currentDirection
        }

        return Point(x,y)
    }
}

enum class D13Direction(val c: Char) {
    UP('^'), DOWN('v'), LEFT('<'), RIGHT('>')
}

enum class D13Cell(vararg val c: Char) {
    VERTICAL('|', '^', 'v'),
    HORIZONTAL('-', '>', '<'),
    INTERSECTION('+'),
    FORWARD_SLASH('/'),
    BACK_SLASH('\\')
}

